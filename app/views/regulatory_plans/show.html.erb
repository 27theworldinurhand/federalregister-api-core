<% title @regulatory_plan.title %>

<h1 class="title"><span>Unified Agenda <%= @regulatory_plan.regulation_id_number %></span></h1>

<% article_tag do %>
  <div id="metadata_content_area">
    <h1><%= @regulatory_plan.title %></h1>
    <p class="metadata">Unified agenda current as of <%= issue_season(@regulatory_plan) %>

    <div class="box">
      <%# TODO HELP-DESIGN get this grid out of the view %>
      <div class="grid_4 alpha">
        <h4>Download As</h4>
        <%= link_to "XML", @regulatory_plan.source_url(:xml), :class => 'button format list xml', :title => 'Download unified agenda as XML' %>
      </div>
      <div class="grid_4">
        <h4>Share This</h4>
      </div>
      <div class="grid_4">
        <h4>Official Home</h4>
        <%= link_to "Official home", @regulatory_plan.source_url(:html) %>
      </div>

      <%#= link_to "XML", @regulatory_plan.source_url(:xml) %></li>
      <%#= link_to "Short URL", short_regulatory_plan_path(@regulatory_plan) %></li>

    </div>
  </div>
  
  <div id="content_area">  
    <ul>
    <% @regulatory_plan.agencies.each do |agency| %>
      <li><%= link_to agency.name, agency_path(agency) %></li>
    <% end %>
    </ul>
    
    <%
    [
      ['Summary', 'abstract'],
      ['Statement of need', 'statement_of_need'],
      ['Legal Basis', 'legal_basis'],
      ['Alternatives', 'alternatives'],
      ['Costs and Benefits', 'costs_and_benefits'],
      ['Risks', 'risks']
    ].each do |label, method |
      value = @regulatory_plan.send(method)
      next if value.blank? %>
      <div class="header_column">
        <h1><%= label %></h1>
      </div>
      <div class="body_column">
        <%= format_regulation_text(@regulatory_plan.send(method)) %>
      </div>
    <% end %>
  
    <%= render :esi => regulatory_plan_timeline_path(@regulatory_plan)%>
  
    <% if @regulatory_plan.contacts.present? %>
      <div class="header_column">
        <h1>Contacts</h1>
      </div>
      <div class="body_column">
        <% @regulatory_plan.contacts.each do |contact| %>
        <div class="vcard">
          <div class="fn">
            <span class="given-name"><%= contact.first_name %></span>
            <span class="family-name"><%= contact.last_name %></span>
          </div>
      
          <% if contact.title.present? %>
          <div class="title"><%= contact.title %></div>
          <% end %>
      
          <% if contact.phone.present? %>
          <div class="tel">
           <span>Phone</span> <%= contact.phone %>
          </div>
          <% end %>
      
          <% if contact.fax.present?%>
          <div class="tel">
            <span class="type">Fax</span> <%= contact.fax %>
          </div>
          <% end %>
          <% if contact.email.present? %>
            <div>Email: 
             <%= mail_to contact.email, contact.email, :class => "email" %>
            </div>
          <% end %>
      
          <div class="adr">
            <div class="street-address"><%= contact.street_address %></div>
            <span class="locality"><%= contact.city %></span>
            <span class="region"><%= contact.state%></span>
            <span class="postal-code"><%= contact.zip %></span>
          </div>
        </div>
        <% end %>
      </div>
    <% end %>
  
    <% count = @regulatory_plan.entries.count %>
    <% if count > 0 %>
      <div class="header_column">
        <h1>Federal Register Activity</h1>
      </div>
      <div class="body_column">
        <p><%= link_to "#{pluralize(count, "article")} found", entries_search_path(:conditions => {:regulation_id_number => @regulatory_plan.regulation_id_number})%></p>
      </div>
    <% end %>
  
  </div> <!-- CONTENT_AREA END -->
  
  <% aside_tag(:id => 'sidebar') do %>
    <% section_tag(:id => 'metadata') do %>
      <dl class="metadata_list pull_out">
        <% %w(priority_category major regulatory_flexibility_analysis_required energy_affected).each do |attribute| %>
          <% value = @regulatory_plan.send(attribute) %>
          <% if value.present? %>
            <%# HELP-DESIGN: icons might be nice for these guys; they are all Yes/No/Undetermined %>
            <dt><%= attribute.humanize %></dt>
            <dd><%= value %></dd>
          <% end %>
        <% end %>
      </dl>
    <% end -%>
    
    <% if @regulatory_plan.cfr_citations.present? %>    
      <% section_tag(:id => 'related_cfr_content') do %>
        <h1 class="title_bar">Related CFR Content</h1>
        <ul class="bullets">
          <% @regulatory_plan.cfr_citations.each do |cfr_citation| %>
            <li><%= add_citation_links(cfr_citation) %></li>
          <% end %>
        </ul>
      <% end %>
    <% end -%>
    
    <% if @regulatory_plan.legal_authorizations.present? %>
      <% section_tag(:id => 'legal_authority') do %>
        <h1 class="title_bar">Legal Authority</h1>
        <ul class="bullets">
          <% @regulatory_plan.legal_authorizations.each do |authorization| %>
          <li><%= add_citation_links(authorization) %></li>
          <% end %>
        </ul>
      <% end %>
    <% end -%>
    
    <% if @regulatory_plan.government_levels_affected.present? %>
      <% section_tag(:id => 'gov_levels_affected') do %>
        <h1 class="title_bar">Government Levels Affected</h1>
        <ul class="bullets">
          <% @regulatory_plan.government_levels_affected.each do |level| %>
            <li><%= level %></li>
          <% end %>
        </ul>
      <% end -%>  
    <% end %>
    
    
    <% if @regulatory_plan.small_entities_affected.present? %>
      <% section_tag(:id => 'small_entities_affected') do %>
        <h1 class="title_bar">Small Entities Affected</h1>
        <ul class="bullets">
          <% @regulatory_plan.small_entities_affected.each do |entity| %>
          <li><%= entity %></li>
          <% end %>
        </ul>
      <% end -%>
    <% end %>
    
  <% end -%> <!-- end aside tag -->
  
<% end -%> <!-- end article tag -->
