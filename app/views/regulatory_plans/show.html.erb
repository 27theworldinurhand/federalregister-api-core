<% title @regulatory_plan.title %>

<h1 class="title"><span>Regulation <%= @regulatory_plan.regulation_id_number %></span></h1>

<article>
  <h1><%= @regulatory_plan.title %></h1>
  <p class="metadata">Regulatory plan current as of <%= issue_season(@regulatory_plan) %>

  <div class="box">
    <%# TODO HELP-DESIGN get this grid out of the view %>
    <div class="grid_4 alpha">
      <h4>Download As</h4>
      <%= link_to "XML", @regulatory_plan.source_url(:xml), :class => 'button format list xml', :title => 'Download unified agenda as XML' %>
    </div>
    <div class="grid_4">
      <h4>Share This</h4>
    </div>
    <div class="grid_4">
      <h4>Official Home</h4>
      <%= link_to "Official home", @regulatory_plan.source_url(:html) %>
    </div>

    <%#= link_to "XML", @regulatory_plan.source_url(:xml) %></li>
    <%#= link_to "Short URL", short_regulatory_plan_path(@regulatory_plan) %></li>

  </div>
  
  <ul>
  <% @regulatory_plan.agencies.each do |agency| %>
    <li><%= link_to agency.name, agency_path(agency) %></li>
  <% end %>
  </ul>
  
  <% if @regulatory_plan.abstract.present? %>
    <div class="header_column">
      <h1>Summary</h1>
    </div>
    <div class="body_column">
      <p><%= add_citation_links(simple_format(@regulatory_plan.abstract)) %></p>
    </div>
  <% end -%>
  
  <div class="header_column">  
    <h1>Details</h1>
  </div>
  <div class="body_column">
    <dl class="split_list pull_out">
      <% %w(priority_category statement_of_need legal_basis alternatives costs_and_benefits risks).each do |attribute| %>
        <% value = @regulatory_plan.send(attribute) %>
        <% if value.present? %>
          <dt><%= attribute.humanize %></dt>
          <dd><%= add_citation_links(simple_format(value)) %></dd>
        <% end %>
      <% end %>
      <% %w(major regulatory_flexibility_analysis_required energy_affected).each do |attribute| %>
        <% value = @regulatory_plan.send(attribute) %>
        <% if value.present? %>
          <%# HELP-DESIGN: icons might be nice for these guys; they are all Yes/No/Undetermined %>
          <dt><%= attribute.humanize %></dt>
          <dd><%= value %></dd>
        <% end %>
      <% end %>
    </dl>
  </div>
  
  <% if @regulatory_plan.legal_authorizations.present? %>
  <div class="header_column">
    <h1>Legal Authority</h1>
  </div>
  <div class="body_column">
    <ul>
      <% @regulatory_plan.legal_authorizations.each do |authorization| %>
      <li><%= add_citation_links(authorization) %></li>
      <% end %>
    </ul>
  </div>
  <% end %>
  
  <% if @regulatory_plan.cfr_citations.present? %>
  <div class="header_column">
    <h1>Related CFR Content</h1>
  </div>
  <div class="body_column">
    <ul>
      <% @regulatory_plan.cfr_citations.each do |cfr_citation| %>
      <li><%= add_citation_links(cfr_citation) %></li>
      <% end %>
    </ul>
  </div>
  <% end %>
  
  <% if @regulatory_plan.government_levels_affected.present? %>
  <div class="header_column">
    <h1>Government Levels Affected</h1>
  </div>
  <div class="body_column">
    <ul>
      <% @regulatory_plan.government_levels_affected.each do |level| %>
      <li><%= level %></li>
      <% end %>
    </ul>
  </div>
  <% end %>
  
  <% if @regulatory_plan.small_entities_affected.present? %>
  <div class="header_column">
    <h1>Small Entities Affected</h1>
  </div>
  <div class="body_column">
    <ul>
      <% @regulatory_plan.small_entities_affected.each do |entity| %>
      <li><%= entity %></li>
      <% end %>
    </ul>
  </div>
  <% end %>
  
  <%= render :partial => 'regulatory_plans/timeline', :locals => {:regulatory_plan => @regulatory_plan} %>
  
  <% if @regulatory_plan.contacts.present? %>
    <div class="header_column">
      <h1>Contacts</h1>
    </div>
    <div class="body_column">
      <% @regulatory_plan.contacts.each do |contact| %>
      <div class="vcard">
        <div class="fn">
          <span class="given-name"><%= contact.first_name %></span>
          <span class="family-name"><%= contact.last_name %></span>
        </div>
      
        <% if contact.title.present? %>
        <div class="title"><%= contact.title %></div>
        <% end %>
      
        <% if contact.phone.present? %>
        <div class="tel">
         <span>Phone</span> <%= contact.phone %>
        </div>
        <% end %>
      
        <% if contact.fax.present?%>
        <div class="tel">
          <span class="type">Fax</span> <%= contact.fax %>
        </div>
        <% end %>
        <% if contact.email.present? %>
          <div>Email: 
           <%= mail_to contact.email, contact.email, :class => "email" %>
          </div>
        <% end %>
      
        <div class="adr">
          <div class="street-address"><%= contact.street_address %></div>
          <span class="locality"><%= contact.city %></span>
          <span class="region"><%= contact.state%></span>
          <span class="postal-code"><%= contact.zip %></span>
        </div>
      </div>
      <% end %>
    </div>
  <% end %>
  
  <% count = @regulatory_plan.entries.count %>
  <% if count > 0 %>
    <div class="header_column">
      <h1>Federal Register Activity</h1>
    </div>
    <div class="body_column">
      <p><%= link_to "#{pluralize(count, "articles")} found", entries_search_path(:conditions => {:regulation_id_number => @regulatory_plan.regulation_id_number})%></p>
    </div>
  <% end %>
</article>