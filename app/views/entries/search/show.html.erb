<% title @search.term.blank? ? 'Article Search' : "Article Search Results for '#{h @search.term}'" %>

<h1 class="title"><span>Search FR Articles</span></h1>

<% unless @search.valid? %>
<ul class="errors">
  <% @search.errors.each do |err| %>
  <li><%= err %></li>
  <% end %>
</ul>
<% end %>

<%= render :esi => url_for(params.merge(:action => :header)) %>

<% unless @search.blank? %>

  <div class="filters">
    <%= render :esi => url_for(params.merge(:action => :facets, :facet => 'date')) unless @search.start_date.present? %>
    <%# TODO HELP-RUBY i know this doesn't go here. just wanted to stash it somewhere  %>
    <!-- <li><%#= sparkline(:data => @search.date_distribution.to_a.sort_by{|date, count| date}.map{|date, count| count}, :alt => "Monthly Distribution" ) %></li> -->
    
    <%= render :esi => url_for(params.merge(:action => :facets, :facet => 'type')) %>
    <%= render :esi => url_for(params.merge(:action => :facets, :facet => 'section')) %>
    <%= render :esi => url_for(params.merge(:action => :facets, :facet => 'agency')) %>
    <%= render :esi => url_for(params.merge(:action => :facets, :facet => 'topic')) %>
    
    <%= render :partial => 'search/location_form', :locals => {:search => @search } %>
  </div>
  
  <%= render :esi => url_for(params.merge(:action => :results)) %>
<% end %>