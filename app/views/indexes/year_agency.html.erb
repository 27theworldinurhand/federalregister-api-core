<% title "#{@year} FR Index" %>

<%= add_template('admin/fr_index_entry_popover', 'fr-index-entry-popover') %>
<%= add_template('admin/fr_index_entry_popover_content', 'fr-index-entry-popover-content') %>

<div class="title"><span><%= @year %> FR Index</span></div>

<h1><%= link_to @agency.name, agency_path(@agency) %></h1>

<% @entries_by_type.each do |type, entries_by_subject| %>
  <div class="entry_type">
    <h3><%= Entry::ENTRY_TYPES[type].pluralize %></h3>
    <ul>
    <% entries_by_subject.each do |subject, entries_by_title| %>
      <% if subject %>
        <li>
          <%= subject %>
          <ul>
      <% end %>
      <% entries_by_title.each do |title, entries| %>
        <% id = rand(100000) %> 
        <li>
          <a href="javascript:" data-toggle="collapse" data-target="#<%= id %>" class="toc_title">
            <%= title %>
            <span class="count_pill"><%= entries.count %></span>
          </a>
          <div id="<%= id %>" style="height: 0px; overflow-y: hidden">
            <% entries.group_by(&:publication_month).each do |month, entries| %>
              <h6><%= month %></h6>
              <dl> 
                <% entries.each do |entry| %>
                  <dt class="with_ajax_popover" data-document-number=<%= entry.document_number %>>Published:</dt>
                  <dd><%= link_to entry.publication_date, entry_path(entry) %></dd> 
                  
                  <dt>FR Document:</dt>
                  <dd><%= link_to entry.document_number, entry_path(entry) %></dd>
                  
                  <dt><%= pluralize_without_count(entry.human_length, 'Page') %>:</dt>
                  <dd class='pages'><%= link_to entry.page_range, entry.source_url('pdf') %> <%= "(#{pluralize(entry.human_length, 'page')})" if entry.human_length > 1 %></dd>
                <% end %>
              </dl>
              <% end %>
          </div>
        </li>
      <% end %>
      <% if subject %>
          </ul>
        </li>
      <% end %>
    <% end %>
    </ul>
  </div>
<% end %>
