<%# TODO HELP-RUBY can we go next/prev on the calendar page %>
<%# title 'Explore by date' %>
<% content_for :precolumn do %>
  <h1>Explore by date</h1>
<% end %>

<div class='header group'>
  <h2>
    Entries for <%= @referenced_dates.first.date.to_formatted_s(:month_year) %>
    <span>(<%= pluralize(@entries.size, 'entry') %>)<span>
  </h2>
  
  <%# TODO HELP-RUBY see entries/by_date to see these in action %>
  <a href="" class="icon arrow prev floatLeft">Prev</a> 
  <a href="" class="icon arrow next floatRight">Next</a>
  
</div>

<% if @day.nil? %>
  <%= dates_calendar_view(@referenced_dates, @year, @month) %>
  <% add_javascript(:src => 'calendar') %>
<% end %>

<ul>
<% @referenced_dates.group_by(&:date).each do |date, referenced_dates| %>
  <li id='date_<%= date.to_s(:db) %>' class='calendar_date'>
    <h3 class='clear'><%= date.to_formatted_s(:pretty) %></h3>
    <ul>
    <% referenced_dates.each do |referenced_date| %>
      <li><%= link_to(referenced_date.entry.title, entry_path(referenced_date.entry) ) %></li>
    <% end %>
    </ul>
  </li>
<% end %>
</ul>

<% content_for :sidebar do %>
  <% unless @agency_values.blank? %>
    <h3>Agencies Reporting This Month</h3>
    <div class='chart size_<%=@agency_values.size%>'><%= pie_3d_chart(:alt => 'Agencies using this Topic Group', :legend => @agency_labels, :truncate_legend => '30', :counts => true, :legend_location => 'bottom', :data => @agency_values, :size => ['230','350'], :color_range => ['005073','84cedb'], :transparent_bg => true) %></div>
  <% end %>
  
  <% unless @granule_values.blank? %>
    <h3>Entry Types This Month</h3>
     <div class='chart size_<%=@granule_values.size%>'><%= pie_3d_chart(:alt => 'Entry Type for Recent Entries', :legend => @granule_labels, :truncate_legend => '30', :counts => true, :legend_location => 'bottom', :data => @granule_values, :size => ['230','200'], :color_range => ['005073','84cedb'], :transparent_bg => true) %></div>
  <% end %>
<% end %>