<% super_title "#{@fr_index.year} FR Index" %>

<% sidebar(render :partial => 'nav', :locals => {:years => @years, :current_year => @fr_index.year}) %>

<div id="fr-index-metadata" class="page_summary">
  <h1><%= @fr_index.year %> Federal Register Index</h1>

  <hr />

  <p id="agency-jump-nav">
    Jump to Agencies: <%= @fr_index.agencies_by_letter.map{|letter,agencies| "<a href='##{letter}' class='letter_link'>#{letter}</a>"}.join(' | ') %>
  <p>

  <div class="agency_index_actions">
    <% form_tag(url_for(:max_date => @fr_index.last_issue_published), :method => :get, :class => 'max_date') do %>
      <%= max_date_select(@fr_index) %>
    <% end %>
     <%= link_to 'Preview PDF', {:format => :pdf, :max_date => params[:max_date]}, :class => "btn pdf_preview" %>
  </div>
</div>

<div class="index_agencies">
  <% @fr_index.agencies_by_letter.each do |letter, agencies| %>
    <h3 id="<%= letter %>">
      <%= letter %>
      <a href="#fr-index-metadata">back to top</a>
    </h3>

    <ul>
      <% agencies.each do |agency| %>
        <li>
          <%= render :partial => "agency_name", :locals => {:agency => agency, :max_date => @max_date} %>

          <% if agency.children.present? %>
            <ul>
              <% agency.children.each do |sub_agency| %>
                <li>
                  <span class="see">See</span> 
                  <%= render :partial => "agency_name", :locals => {:agency => sub_agency, :max_date => @max_date} %>
                </li>
              <% end %>
            </ul>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% end %>
</div>
