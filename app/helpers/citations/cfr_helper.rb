module Citations::CfrHelper
  #The annual update cycle is as follows: titles 1-16 are revised as of January 1; titles 17-27 are revised as of April 1; titles 28-41 are revised as of July 1; and titles 42-50 are revised as of October 1.
  CFR_EDITION_PUBLICATION_OFFSET = 3.months
  
  EDITION_SCHEDULE = {
    1..16  => '01-01',
    17..27 => '04-01',
    28..41 => '07-01',
    42..50 => '10-01',
  }
  
  VOLUMES_TO_SKIP = {
   2010 => [26],
   2009 => [26, 29, 40, 50],
   2008 => [26, 29, 40, 50],
   2007 => [26, 29, 40, 50],
   2006 => [26, 29, 40, 50],
   2005 => [7, 26, 29, 40, 50],
   2004 => [7, 26, 29, 40, 50],
   2003 => [7, 26, 29, 40, 50],
   2002 => [7, 26, 29, 40, 41, 50],
   2001 => [7, 26, 29, 40],
   2000 => [7, 26, 29, 40],
  }

  TITLE_AND_PART_TO_VOLUME = {
   2010 => {
     5 => {
       1..630      => 1,
       700..1199   => 2,
       1200..9901  => 3,
     },
     7 => {
       1..26       => 1,
       53..209     => 3,
       210..299    => 4,
       300..399    => 5,
       400..699    => 6,
       700..868    => 7,
       900..999    => 8,
       1600..1755  => 11,
     },
     9 => {
       1..199      => 1,
       200..592    => 2,
     },
     10 => {
       1..50       => 1,
       51..199     => 2,
       200..499    => 3,
       500..1800   => 4,
     },
     12 => {
       1..199      => 1,
       200..219    => 2,
       220..299    => 3,
       300..499    => 4,
       500..599    => 5,
       600..811    => 6,
     },
     14 => {
       1..59        => 1,
       60..109      => 2,
       110..199     => 3,
       200..1199    => 4,
       1200..1310   => 5,
     },
     15 => {
       0..299       => 1,
       800..2301    => 3,
     },
     16 => {
       0..999       => 1,
       1000..1750   => 2,
     },
     17 => {
       1..199       => 1,
       200..239     => 2,
       240..450     => 3,
     },
     18 => {
       1..399       => 1,
       400..1317    => 2,
     },
     19 => {
       0..140       => 1,
       141..199     => 2,
       200..360     => 3,
     },
     20 => {
       1..375       => 1,
       400..499     => 2,
       500..1010    => 3,
     },
     21 => {
       1..99        => 1,
       100..169     => 2,
       200..299     => 4,
       300..499     => 5,
       500..599     => 6,
       600..799     => 7,
       800..1299    => 8,
       1300..1499   => 9,
     },
     24 => {
       0..180       => 1,
       200..499     => 2,
       500..599     => 3,
       700..1699    => 4,
     },
     25 => {
       1..293       => 1,
       300..1200    => 2,
     },
     # 26 is complicated...skipping some parts
     26 => {
        30..39      =>15,
     },
     27 => {
       1..31        => 1,
       40..399      => 2,
     },
   },
   2009 => {
     5 => {
        1..630      =>1,
        700..1199   =>2,
        1200..9901  =>3,
     },
     7 => {
        1..26       =>1,
        27..52      =>2,
        53..209     =>3,
        210..299    =>4,
        300..399    =>5,
        400..699    =>6,
        700..868    =>7,
        900..999    =>8,
        1000..1199  =>9,
        1200..1599  =>10,
        1600..1759  =>11,
        1760..1939  =>12,
        1940..1949  =>13,
        1950..1999  =>14,
        2000..5001  =>15,
     },
     9 => {
        1..199      =>1,
        200..592    =>2,
     },
     10 => {
        1..50       =>1,
        51..199     =>2,
        200..499    =>3,
        500..1800   =>4,
     },
     12 => {
        1..199      =>1,
        200..219    =>2,
        220..299    =>3,
        300..499    =>4,
        500..599    =>5,
        600..811    =>6,
        900..1815   =>7,
     },
     14 => {
        1..59       =>1,
        60..109     =>2,
        110..199    =>3,
        200..1199   =>4,
        1200..1310  =>5,
     },
     15 => {
        0..296      =>1,
        300..799    =>2,
        800..2301   =>3,
     },
     16 => {
        0..999      =>1,
        1000..1750  =>2,
     },
     17 => {
        1..199      =>1,
        200..239    =>2,
        240..450    =>3,
     },
     18 => {
        1..399      =>1,
        400..1317   =>2,
     },
     19 => {
        0..140      =>1,
        141..199    =>2,
        200..361    =>3,
     },
     20 => {
        1..375      =>1,
        400..499    =>2,
        500..1010   =>3,
     },
     21 => {
        1..99       =>1,
        100..169    =>2,
        170..199    =>3,
        200..299    =>4,
        300..499    =>5,
        500..599    =>6,
        600..799    =>7,
        800..1299   =>8,
        1300..1499  =>9,
     },
     22 => {
        1..299      =>1,
        300..1701   =>2,
     },
     24 => {
        0..180      =>1,
        200..499    =>2,
        500..599    =>3,
        700..1699   =>4,
        1700..4100  =>5,
     },
     25 => {
        1..293      =>1,
        300..1200   =>2,
     },
     # 26 is complicated...skipping some parts
     26 => {
        2..29       =>14,
        30..39      =>15,
        40..49      =>16,
        50..299     =>17,
        300..499    =>18,
     },
     27 => {
        1..31       =>1,
        40..399     =>2,
        400..646    =>3,
     },
     # 29 is complicated...skipping some parts
     29 => {
        0..99       =>1,
        100..470    =>2,
        500..899    =>3,
        900..1899   =>4,
        1911..1925  =>7,
        1926..1926  =>8,
        1927..4907  =>9,
     },
     30 => {
       1..199       => 1,
       200..402     => 2,
       700..955     => 3,
     },
     31 => {
       0..199       => 1,
       200..413     => 2,
       500..904     => 3,
     },
     32 => {
       400..629     => 3,
       630..699     => 4,
       700..799     => 5,
     },
     33 => {
       1..120       => 1,
       125..199     => 2,
       200..499     => 3,
     },
     34 => {
       1..299       => 1,
       300..399     => 2,
       400..1200    => 3,
     },
     36 => {
       1..199       => 1,
       200..299     => 2,
       300..1600    => 3,
     },
     # 40 is complicated...skipping some parts
     40 => {
        1..49       =>1,
        50..51      =>2,
        60..60      =>7,
        61..62      =>8,
        64..71      =>15,
        72..80      =>16,
        81..84      =>17,
        87..99      =>20,
        100..135    =>21,
        190..259    =>24,
        260..265    =>25,
        266..282    =>26,
        300..399    =>27,
        400..424    =>28,
        425..699    =>29,
        700..789    =>30,
        790..799    =>31,
     },
     41 => {
       50..61       => 1,
       101..101     => 2,
       102..128     => 3,
       300..304     => 4,
     },
     42 => {
       1..199       => 1,
       400..413     => 2,
       414..426     => 3,
       430..481     => 4,
       482..1008    => 5,
     },
     45 => {
       1..199       => 1,
       200..499     => 2,
       500..1199    => 3,
       1200..2555   => 4,
     },
     46 => {
       1..39        => 1,
       41..69       => 2,
       70..89       => 3,
       90..139      => 4,
       159..165     => 6,
       200..404     => 8,
       500..565     => 9,
     },
     47 => {
       0..19        => 1,
       20..39       => 2,
       40..69       => 3,
       70..79       => 4,
       80..400      => 5,
     },
     48 => {
       1..51        => 1,
       52..99       => 2,
       201..253     => 3,
       301..653     => 4,
       701..1499    => 5,
       1501..2852   => 6,
       2901..9905   => 7,
     },
     49 => {
       1..99        => 1,
       105..185     => 2,
       186..199     => 3,
       200..299     => 4,
       300..399     => 5,
       400..571     => 6,
       572..999     => 7,
       1000..1199   => 8,
       1200..1580   => 9,
     },
     # 50 is complicated...skipping some parts
     50 => {
        1..16       =>1,
        18..199     =>6,
        216..560    =>7,
        600..659    =>8,
        660..697    =>9,
     },
   },
   2008 => {
    5 => {
      1..630        =>1,
      715..1001     =>2,
      1200..9901    =>3, 
    },
    7 => {
      1..26         =>1,
      27..52        =>2,
      53..209       =>3,
      210..299      =>4,
      300..399      =>5,
      400..699      =>6,
      701..868      =>7,
      900..999      =>8,
      1000..1199    =>9,
      1200..1599    =>10,
      1600..1899    =>11,
      1900..1939    =>12,
      1940..1949    =>13,
      1950..1999    =>14,
      2003..4290    =>15,
    },
    9 => {
      1..199        =>1,
      200..592      =>2,
    },
    10 => {
      1..50         =>1,
      200..499      =>3,
      500..1800     =>4,
    },
    12 => {
      1..199        =>1,
      201..219      =>2,
      220..299      =>3,
      300..499      =>4,
      500..599      =>5,
      600..811      =>6,
      900..1815     =>7,
    },
    14 => {
      1..59         =>1,
      60..139       =>2,
      140..199      =>3,
      200..1199     =>4,
      1200..1310    =>5,
    },
    15 => {
      0..299        =>1,
      301..799      =>2,
      801..2301     =>3,
    },
    16 => {
      0..999        =>1,
      1000..1750    =>2,
    },
    17 => {
      1..199        =>1,
      200..239      =>2,
      240..450      =>3,
    },
    18 => {
      1..399        =>1,
      401..1317     =>2,
    },
    19 => {
      0..140        =>1,
      141..199      =>2,
      200..361      =>3,
    },
    20 => {
      1..375        =>1,
      400..499      =>2,
      501..1002     =>3,
    },
    21 => {
      1..99         =>1,
      100..169      =>2,
      170..199      =>3,
      200..299      =>4,
      300..499      =>5,
      500..599      =>6,
      600..799      =>7,
      800..1299     =>8,
      1300..1499    =>9,
    },
    22 => {
      1..299        =>1,
      301..1701     =>2,
    },
    24 => {
      0..180        =>1,
      200..499      =>2,
      500..599      =>3,
      700..1699     =>4,
      1710..4100    =>5,
    },
    # 26 is complicated...skipping some parts
    26 => {
      2..29         =>14,
      31..39        =>15,
      40..49        =>16,
      50..299       =>17,
      300..499      =>18,
    },
    27 => {
      1..31         =>1,
      40..399       =>2,
      400..646      =>3,
    },
    28 => {
      0..42         =>1,
      43..1100      =>2,
    },
    # 29 is complicated...skipping some parts
    29 => {
      0..99         =>1,
      100..470      =>2,
      500..899      =>3,
      900..1899     =>4,
      1911..1925    =>7,
      1926..1926    =>8,
      1927..4907    =>9,
    },
    30 => {
      1..199        =>1,
      201..402      =>2,
      700..955      =>3,
    },
    31 => {
      0..199        =>1,
      202..413      =>2,
      500..903      =>3,
    },
    32 => {
      1..187        =>1,
      191..399      =>2,
      400..629      =>3,
      630..699      =>4,
      700..799      =>5,
      800..2800     =>6,
    },
    33 => {
      1..120        =>1,
      125..199      =>2,
      203..499      =>3,
    },
    34 => {
      3..299        =>1,
      300..399      =>2,
      400..1200     =>3,
    },
    36 => {
      1..199        =>1,
      200..299      =>2,
      312..1600     =>3,
    },
    38 => {
      0..17         =>1,
      18..75        =>2,
    },
    # 40 is complicated...skipping some parts
    40 => {
      1..49         =>1,
      50..51        =>2,
      53..59        =>5,
      61..62        =>8,
      64..71        =>15,
      72..80        =>16,
      81..84        =>17,
      87..99        =>20,
      100..135      =>21,
      136..149      =>22,
      150..189      =>23,
      190..259      =>24,
      260..265      =>25,
      266..282      =>26,
      300..399      =>27,
      400..424      =>28,
      425..699      =>29,
      700..789      =>30,
      790..1700     =>31,
    },
    41 => {
      50..61        =>1,
      101..101      =>2,
      102..128      =>3,
      300..304      =>4,
    },
    42 => {
      400..413      =>2,
      414..426      =>3,
      430..1008     =>4,
    },
    43 => {
      1..999        =>1,
      1000..10010   =>2,
    },
    45 => {
      1..199        =>1,
      200..499      =>2,
      500..1199     =>3,
      1201..2555    =>4,
    },
    46 => {
      1..39         =>1,
      41..69        =>2,
      70..89        =>3,
      90..139       =>4,
      140..155      =>5,
      159..165      =>6,
      166..199      =>7,
      200..404      =>8,
      500..565      =>9,
    },
    47 => {
      0..19         =>1,
      20..39        =>2,
      42..69        =>3,
      70..79        =>4,
      80..301       =>5,
    },
    48 => {
      1..51         =>1,
      52..99        =>2,
      201..253      =>3,
      301..653      =>4,
      701..1499     =>5,
      1501..2852    =>6,
      2901..9905    =>7,
    },
    49 => {
      1..99         =>1,
      105..185      =>2,
      190..199      =>3,
      200..299      =>4,
      301..399      =>5,
      400..599      =>6,
      601..999      =>7,
      1000..1199    =>8,
      1200..1572    =>9,
    },
    # 50 is complicated...skipping some parts
    50 => {
      1..16         =>1,
      18..199       =>6,
      219..560      =>7,
      600..659      =>8,
      660..697      =>9,
    },
   },
   2007 => {
      5 => {
        1..630      =>1,
        715..1001   =>2,
        1200..9901  =>3,
      },
      7 => {
        1..26       =>1,
        27..52      =>2,
        53..209     =>3,
        210..299    =>4,
        300..399    =>5,
        400..699    =>6,
        701..868    =>7,
        900..999    =>8,
        1000..1199  =>9,
        1200..1599  =>10,
        1600..1899  =>11,
        1900..1939  =>12,
        1940..1949  =>13,
        1950..1999  =>14,
        2003..4290  =>15,
      },
      10 => {
        1..50       =>1,
        51..199     =>2,
        200..499    =>3,
        500..1800   =>4,
      },
      12 => {
        1..199      =>1,
        201..219    =>2,
        220..299    =>3,
        300..499    =>4,
        500..599    =>5,
        600..811    =>6,
        900..1815   =>7,
      },
      14 => {
        1..59       =>1,
        60..139     =>2,
        200..1199   =>4,
        1200..1310  =>5,
      },
      15 => {
        0..299      =>1,
        301..799    =>2,
        801..2301   =>3,
      },
      16 => {
        0..999      =>1,
        1000..1750  =>2,
      },
      17 => {
        1..199      =>1,
        240..450    =>3,
      },
      18 => {
        1..399      =>1,
        401..1317   =>2,
      },
      19 => {
        0..140      =>1,
        141..199    =>2,
        200..361    =>3,
      },
      20 => {
        1..375      =>1,
        400..499    =>2,
        501..1002   =>3,
      },
      21 => {
        1..99       =>1,
        170..199    =>3,
        200..299    =>4,
        300..499    =>5,
        500..599    =>6,
        600..799    =>7,
        800..1299   =>8,
        1300..1499  =>9,
      },
      22 => {
        1..299      =>1,
        301..1701   =>2,
      },
      24 => {
        0..180      =>1,
        200..499    =>2,
        500..599    =>3,
        700..1699   =>4,
        1710..4100  =>5,
      },
      # 26 is complicated...skipping some parts
      26 => {
        31..36      =>15,
        40..49      =>16,
        50..299     =>17,
        300..499    =>18,
      },
      27 => {
        1..31       =>1,
        40..399     =>2,
        400..646    =>3,
      },
      28 => {
        0..42       =>1,
        43..1100    =>2,
      },
      # 29 is complicated...skipping some parts
      29 => {
        0..99       =>1,
        100..470    =>2,
        500..899    =>3,
        900..1899   =>4,
        1911..1925  =>7,
        1926..1926  =>8,
        1927..4907  =>9,
      },
      30 => {
        1..199      =>1,
        201..402    =>2,
        700..955    =>3,
      },
      31 => {
        0..199      =>1,
        202..413    =>2,
        500..904    =>3,
      },
      32 => {
        1..187      =>1,
        191..399    =>2,
        400..629    =>3,
        631..699    =>4,
        700..799    =>5,
        800..2800   =>6,
      },
      33 => {
        1..120      =>1,
        125..199    =>2,
        203..499    =>3,
      },
      34 => {
        3..299      =>1,
        300..396    =>2,
        400..1200   =>3,
      },
      36 => {
        1..199      =>1,
        200..299    =>2,
        312..1600   =>3,
      },
      38 => {
        0..17       =>1,
        18..75      =>2,
      },
      # 40 is complicated...skipping some parts
      40 => {
        1..49       =>1,
        50..51      =>2,
        53..59      =>5,
        61..62      =>8,
        64..71      =>15,
        72..80      =>16,
        81..82      =>17,
        87..99      =>20,
        100..135    =>21,
        136..149    =>22,
        150..189    =>23,
        190..259    =>24,
        260..265    =>25,
        266..282    =>26,
        300..399    =>27,
        400..424    =>28,
        425..699    =>29,
        700..789    =>30,
        790..1700   =>31,
      },
      41 => {
        50..61      =>1,
        101..101    =>2,
        102..128    =>3,
        300..304    =>4,
      },
      42 => {
        1..199      =>1,
        400..413    =>2,
        414..426    =>3,
        430..1008   =>4,
      },
      43 => {
        1..999      =>1,
        1000..10010 =>2,
      },
      45 => {
        1..199      =>1,
        200..499    =>2,
        500..1199   =>3,
        1201..2555  =>4,
      },
      46 => {
        1..39       =>1,
        41..69      =>2,
        70..89      =>3,
        90..139     =>4,
        140..155    =>5,
        159..165    =>6,
        166..199    =>7,
        200..404    =>8,
        500..565    =>9,
      },
      47 => {
        0..19       =>1,
        20..36      =>2,
        42..69      =>3,
        70..79      =>4,
        80..300     =>5,
      },
      48 => {
        1..51       =>1,
        52..99      =>2,
        201..253    =>3,
        301..653    =>4,
        701..1499   =>5,
        1501..2852  =>6,
        2901..9905  =>7,
      },
      49 => {
        1..99       =>1,
        190..199    =>3,
        200..299    =>4,
        301..399    =>5,
        400..599    =>6,
        601..999    =>7,
        1000..1199  =>8,
        1200..1572  =>9,
      },
      # 50 is complicated...skipping some parts
      50 => {
        1..16       =>1,
        18..199     =>6,
        216..560    =>7,
        600..659    =>8,
        660..697    =>9,
      },
   },
   2006 => {
      5 => {
        1..630      =>1,
        715..1001   =>2,
        1200..9901  =>3,
      },
      7 => {
        1..26       =>1,
        27..52      =>2,
        53..209     =>3,
        210..299    =>4,
        300..399    =>5,
        400..699    =>6,
        700..868    =>7,
        1000..1199  =>9,
        1200..1599  =>10,
        1600..1899  =>11,
        1900..1939  =>12,
        1940..1949  =>13,
        1950..1999  =>14,
        2003..4290  =>15,
      },
      9 => {
        1..199      =>1,
        200..592    =>2,
      },
      10 => {
        1..50       =>1,
        51..199     =>2,
        200..499    =>3,
        500..1800   =>4,
      },
      12 => {
        1..199      =>1,
        201..219    =>2,
        220..299    =>3,
        300..499    =>4,
        500..599    =>5,
        600..811    =>6,
        900..1815   =>7,
      },
      14 => {
        1..59       =>1,
        60..139     =>2,
        140..199    =>3,
        200..1199   =>4,
        1200..1310  =>5,
      },
      15 => {
        0..299      =>1,
        301..799    =>2,
        801..2301   =>3,
      },
      16 => {
        0..999      =>1,
        1000..1750  =>2,
      },
      17 => {
        1..199      =>1,
        200..239    =>2,
        240..450    =>3,
      },
      18 => {
        1..399      =>1,
        401..1317   =>2,
      },
      20 => {
        1..375      =>1,
        400..499    =>2,
        501..1002   =>3,
      },
      21 => {
        1..99       =>1,
        100..169    =>2,
        170..199    =>3,
        200..299    =>4,
        300..499    =>5,
        500..599    =>6,
        600..799    =>7,
        800..1299   =>8,
        1300..1499  =>9,
      },
      22 => {
        1..299      =>1,
        301..1701   =>2,
      },
      24 => {
        0..180      =>1,
        200..499    =>2,
        500..599    =>3,
        700..1699   =>4,
        1710..4100  =>5,
      },
      # 26 is complicated...skipping some parts
      26 => {
        2..29       =>14,
        31..39      =>15,
        40..49      =>16,
        50..299     =>17,
        300..499    =>18,
      },
      27 => {
        1..399      =>1,
        400..646    =>2,
      },
      28 => {
        0..42       =>1,
        43..1100    =>2,
      },
      # 29 is complicated...skipping some parts
      29 => {
        0..99       =>1,
        100..470    =>2,
        500..899    =>3,
        900..1899   =>4,
        1911..1925  =>7,
        1926..1926  =>8,
        1927..4907  =>9,
      },
      30 => {
        1..199      =>1,
        201..402    =>2,
        700..955    =>3,
      },
      31 => {
        0..199      =>1,
        202..413    =>2,
        500..904    =>3,
      },
      32 => {
        1..187      =>1,
        191..399    =>2,
        400..627    =>3,
        631..699    =>4,
        700..799    =>5,
        800..2800   =>6,
      },
      33=> {
        1..120      =>1,
        125..199    =>2,
        203..499    =>3,
      },
      34 => {
        3..299      =>1,
        300..399    =>2,
        400..1200   =>3,
      },
      36 => {
        1..199      =>1,
        200..299    =>2,
        312..1600   =>3,
      },
      38 => {
        0..17       =>1,
        18..61      =>2,
      },
      # 40 is complicated...skipping some parts
      40 => {
        1..49       =>1,
        50..51      =>2,
        52..52      =>3,
        53..59      =>5,
        61..62      =>8,
        64..71      =>15,
        72..80      =>16,
        81..85      =>17,
        87..99      =>20,
        100..135    =>21,
        136..149    =>22,
        150..189    =>23,
        190..259    =>24,
        260..265    =>25,
        266..282    =>26,
        300..399    =>27,
        400..424    =>28,
        425..699    =>29,
        700..789    =>30,
        790..1700   =>31,
      },
      41 => {
        50..61      =>1,
        101..101    =>2,
        102..128    =>3,
        300..304    =>4,
      },
      42 => {
        1..199      =>1,
        400..413    =>2,
        414..426    =>3,
        430..1008   =>4,
      },
      43 => {
        1..999      =>1,
        1000..10010 =>2,
      },
      45 => {
        200..499    =>2,
        500..1199   =>3,
        1201..2555  =>4,
      },
      46 => {
        1..39       =>1,
        41..69      =>2,
        70..89      =>3,
        90..139     =>4,
        140..155    =>5,
        159..165    =>6,
        166..199    =>7,
        200..404    =>8,
        500..565    =>9,
      },
      47 => {
        0..19       =>1,
        20..39      =>2,
        42..69      =>3,
        70..79      =>4,
        80..301     =>5,
      },
      48 => {
        1..51       =>1,
        52..99      =>2,
        201..253    =>3,
        301..653    =>4,
        701..1499   =>5,
        1501..2852  =>6,
      },
      49 => {
        1..99       =>1,
        105..185    =>2,
        190..199    =>3,
        301..399    =>5,
        400..599    =>6,
        601..999    =>7,
        1200..1572  =>9,
      },
      # 50 is complicated...skipping some parts
      50 => {
        18..199     =>6,
        216..560    =>7,
        600..659    =>8,
        660..697    =>9,
      },
   },
   2005 => {
      5 => {
        1..630      =>1,
        715..1001   =>2,
        1200..8701  =>3,
      },
      #7 is complicated...skipping some parts
      7 => {
        1..26       =>1,
        27..52      =>2,
        53..209     =>3,
        210..299    =>4,
        300..399    =>5,
        400..699    =>6,
        700..868    =>7,
        1200..1599  =>10,
        1600..1899  =>11,
        1900..1939  =>12,
        1940..1949  =>13,
        1950..1999  =>14,
        2003..4290  =>15,
      },
      9 => {
        1..199      =>1,
        200..592    =>2,
      },
      10 => {
        1..50       =>1,
        51..199     =>2,
        200..499    =>3,
        500..1800   =>4,
      },
      12 => {
        1..199      =>1,
        201..219    =>2,
        220..299    =>3,
        300..499    =>4,
        500..599    =>5,
        600..811    =>6,
        900..1815   =>7,
      },
      14 => {
        1..59       =>1,
        60..137     =>2,
        140..199    =>3,
        200..1199   =>4,
        1200..1310  =>5,
      },
      15 => {
        0..299      =>1,
        301..799    =>2,
        801..2301   =>3,
      },
      16 => {
        0..999      =>1,
        1000..1750  =>2,
      },
      17 => {
        1..199      =>1,
        200..239    =>2,
        240..450    =>3,
      },
      18 => {
        1..399      =>1,
        401..1317   =>2,
      },
      19 => {
        0..140      =>1,
        141..199    =>2,
        200..360    =>3,
      },
      20 => {
        1..375      =>1,
        400..499    =>2,
        501..1002   =>3,
      },
      21 => {
        1..99       =>1,
        170..199    =>3,
        200..299    =>4,
        300..369    =>5,
        500..599    =>6,
        600..799    =>7,
        800..1299   =>8,
        1300..1499  =>9,
      },
      24 => {
        0..180      =>1,
        200..499    =>2,
        500..599    =>3,
        700..1007   =>4,
        1710..4100  =>5,
      },
      # 26 is complicated...skipping some parts
      26 => {
        2..29       =>14,
        31..39      =>15,
        40..49      =>16,
        50..299     =>17,
        300..499    =>18,
      },
      27 => {
        1..399      =>1,
        400..646    =>2,
      },
      28 => {
        0..42       =>1,
        43..1100    =>2,
      },
      # 29 is complicated...skipping some parts
      29 => {
        0..99       =>1,
        100..470    =>2,
        500..899    =>3,
        900..1899   =>4,
        1911..1925  =>7,
        1926..1926  =>8,
        1927..4907  =>9,
      },
      30 => {
        1..199      =>1,
        201..402    =>2,
        700..955    =>3,
      },
      31 => {
        0..199      =>1,
        202..413    =>2,
        500..904    =>3,
      },
      32 => {
        1..190      =>1,
        191..399    =>2,
        400..627    =>3,
        630..699    =>4,
        700..799    =>5,
        800..2800   =>6,
      },
      33 => {
        1..120      =>1,
        125..187    =>2,
        203..499    =>3,
      },
      34 => {
        3..299      =>1,
        300..399    =>2,
        400..1200   =>3,
      },
      36 => {
        1..199      =>1,
        200..299    =>2,
        312..1600   =>3,
      },
      38 => {
        0..17       =>1,
        18..61      =>2,
      },
      # 40 is complicated...skipping some parts
      40 => {
        1..49       =>1,
        50..51      =>2,
        52..52      =>3,
        53..59      =>5,
        61..62      =>8,
        72..80      =>16,
        81..85      =>17,
        87..99      =>20,
        100..135    =>21,
        136..149    =>22,
        150..189    =>23,
        190..259    =>24,
        260..265    =>25,
        266..282    =>26,
        300..399    =>27,
        700..789    =>30,
        790..1700   =>31,
      },
      41 => {
        50..61      =>1,
        101..101    =>2,
        102..128    =>3,
        300..304    =>4,
      },
      42 => {
        1..199      =>1,
        400..426    =>2,
        430..1008   =>3,
      },
      43 => {
        1..999      =>1,
        1000..10010 =>2,
      },
      45 => {
        1..199      =>1,
        200..499    =>2,
        500..1199   =>3,
        1201..2555  =>4,
      },
      46 => {
        1..39       =>1,
        41..69      =>2,
        70..89      =>3,
        90..139     =>4,
        140..155    =>5,
        159..165    =>6,
        166..199    =>7,
        200..404    =>8,
        500..565    =>9,
      },
      47 => {
        0..19       =>1,
        20..39      =>2,
        42..69      =>3,
        70..79      =>4,
        80..301     =>5,
      },
      48 => {
        1..51       =>1,
        52..99      =>2,
        201..253    =>3,
        301..653    =>4,
        701..1499   =>5,
        1501..2852  =>6,
        2901..9905  =>7,
      },
      49 => {
        1..99       =>1,
        105..185    =>2,
        190..199    =>3,
        200..268    =>4,
        301..399    =>5,
        450..599    =>6,
        601..999    =>7,
        1000..1199  =>8,
        1200..1572  =>9,
      },
      # 50  is complicated...skipping some parts
      50 => {
        1..16       =>1,
        18..199     =>6,
        216..560    =>7,
        600..697    =>8,
      },
   },
   2004 => {
      5 => {
        1..630      =>1,
        715..1001   =>2,
        1200..8701  =>3,
      },
      #7 is complicated...skipping some parts
      7 => {
        1..26       =>1,
        27..52      =>2,
        53..209     =>3,
        210..299    =>4,
        300..399    =>5,
        400..699    =>6,
        700..868    =>7,
        1200..1599  =>10,
        1600..1899  =>11,
        1900..1939  =>12,
        1940..1949  =>13,
        1950..1999  =>14,
        2003..4287  =>15,
      },
      9 => {
        1..199      =>1,
        200..592    =>2,
      },
      10 => {
        1..50       =>1,
        51..199     =>2,
        200..499    =>3,
        500..1800   =>4,
      },
      12 => {
        1..199      =>1,
        201..219    =>2,
        220..299    =>3,
        300..499    =>4,
        500..599    =>5,
        600..811    =>6,
        900..1815   =>7,
      },
      14 => {
        1..59       =>1,
        60..139     =>2,
        140..198    =>3,
        200..1199   =>4,
        1200..1310  =>5,
      },
      15 => {
        0..299      =>1,
        301..799    =>2,
        801..2301   =>3,
      },
      16 => {
        0..999      =>1,
        1000..1750  =>2,
      },
      17 => {
        1..199      =>1,
        200..239    =>2,
        240..450    =>3,
      },
      18 => {
        1..399      =>1,
        401..1317   =>2,
      },
      19 => {
        0..140      =>1,
        141..199    =>2,
        200..360    =>3,
      },
      20 => {
        1..375      =>1,
        400..499    =>2,
        501..1001   =>3,
      },
      21 => {
        1..99       =>1,
        100..169    =>2,
        170..199    =>3,
        200..299    =>4,
        300..499    =>5,
        500..599    =>6,
        600..799    =>7,
        800..1299   =>8,
        1300..1499  =>9,
      },
      22 => {
        1..299      =>1,
        301..1701   =>2,
      },
      24 => {
        0..180      =>1,
        500..699    =>3,
        700..1699   =>4,
        1710..4100  =>5,
      },
      # 26  is complicated...skipping some parts
      26 => {
        2..29       =>14,
        31..39      =>15,
        40..49      =>16,
        50..299     =>17,
        300..499    =>18,
      },
      27 => {
        1..199      =>1,
        200..646    =>2,
      },
      28 => {
        0..42       =>1,
        43..1100    =>2,
      },
      # 29 is complicated...skipping some parts
      29 => {
        1..99       =>1,
        100..470    =>2,
        500..899    =>3,
        900..1899   =>4,
        1911..1925  =>7,
        1926..1926  =>8,
        1927..4907  =>9,
      },
      30 => {
        1..199      =>1,
        201..402    =>2,
        700..955    =>3,
      },
      31 => {
        0..199      =>1,
        202..904    =>2,
      },
      32 => {
        1..190      =>1,
        191..399    =>2,
        400..627    =>3,
        630..668    =>4,
        700..799    =>5,
        800..2800   =>6,
      },
      33 => {
        1..120      =>1,
        125..187    =>2,
        203..499    =>3,
      },
      34 => {
        3..299      =>1,
        300..399    =>2,
        400..1200   =>3,
      },
      36 => {
        1..199      =>1,
        200..299    =>2,
        312..1600   =>3,
      },
      38 => {
        0..17       =>1,
        18..61      =>2,
      },
      # 40 is complicated...skipping some parts
      40 => {
        1..49       =>1,
        50..51      =>2,
        53..59      =>5,
        61..62      =>8,
        64..71      =>14,
        72..80      =>15,
        81..85      =>16,
        87..99      =>19,
        100..135    =>20,
        136..149    =>21,
        150..189    =>22,
        190..259    =>23,
        260..265    =>24,
        266..282    =>25,
        300..399    =>26,
        700..789    =>29,
        790..1700   =>30,
      },
      41 => {
        50..61      =>1,
        101..101    =>2,
        102..128    =>3,
        300..304    =>4,
      },
      42 => {
        1..399      =>1,
        400..426    =>2,
        430..1008   =>3,
      },
      43 => {
        1..999      =>1,
        1000..10010 =>2,
      },
      45 => {
        1..199      =>1,
        200..499    =>2,
        500..1199   =>3,
        1201..2555  =>4,
      },
      46 => {
        1..39       =>1,
        41..69      =>2,
        70..89      =>3,
        90..139     =>4,
        140..155    =>5,
        159..165    =>6,
        166..199    =>7,
        200..404    =>8,
        500..565   =>9,
      },
      47 => {
        0..19       =>1,
        20..39      =>2,
        42..69      =>3,
        70..79      =>4,
        80..301     =>5,
      },
      48 => {
        1..51       =>1,
        52..99      =>2,
        201..253    =>3,
        301..653    =>4,
        701..1499   =>5,
        1501..2852  =>6,
        2901..9905  =>7,
      },
      49 => {
        1..99       =>1,
        105..185    =>2,
        190..199    =>3,
        200..399    =>4,
        450..597    =>5,
        601..999    =>6,
        1000..1199  =>7,
        1200..1572  =>8,
      },
      # 50 is complicated...skipping some parts
      50 => {
        1..16       =>1,
        18..199     =>5,
        216..560    =>6,
        600..697    =>7,
      },
   },
   2003 => {
      5 => {
        1..630      =>1,
        715..1001   =>2,
        1200..8701  =>3,
      },
      # 7 is complicated...skipping some parts
      7 => {
        1..26       =>1,
        27..52      =>2,
        53..209     =>3,
        210..299    =>4,
        400..661    =>6,
        700..868    =>7,
        1200..1570  =>10,
        1600..1899  =>11,
        1900..1939  =>12,
        1940..1949  =>13,
        1950..1999  =>14,
        2003..4287  =>15,
      },
      9 => {
        1..199      =>1,
        200..592    =>2,
      },
      10 => {
        1..50       =>1,
        51..199     =>2,
        200..499    =>3,
        500..1800   =>4,
      },
      12 => {
        1..199      =>1,
        201..219    =>2,
        220..299    =>3,
        300..499    =>4,
        500..599    =>5,
        600..811    =>6,
        900..1815   =>7,
      },
      14 => {
        1..59       =>1,
        60..139     =>2,
        140..198    =>3,
        200..1199   =>4,
        1200..1310  =>5,
      },
      15 => {
        301..799    =>2,
        801..2301   =>3,
      },
      16 => {
        0..999      =>1,
        1000..1750  =>2,
      },
      17 => {
        1..191      =>1,
        200..239    =>2,
        240..450    =>3,
      },
      18 => {
        1..399      =>1,
        401..1317   =>2,
      },
      19 => {
        0..140      =>1,
        141..199    =>2,
        200..360    =>3,
      },
      20 => {
        1..375      =>1,
        400..499    =>2,
        501..1001   =>3,
      },
      21 => {
        1..99       =>1,
        100..169    =>2,
        170..199    =>3,
        200..299    =>4,
        300..499    =>5,
        500..599    =>6,
        600..799    =>7,
        800..1299   =>8,
        1300..1404  =>9,
      },
      22 => {
        1..299      =>1,
        301..1701   =>2,
      },
      24 => {
        0..180      =>1,
        200..499    =>2,
        500..699    =>3,
        700..1699   =>4,
        1710..4100  =>5,
      },
      # 26  is complicated...skipping some parts
      26 => {
        2..29       =>14,
        31..39      =>15,
        40..49      =>16,
        50..157     =>17,
        300..499    =>18,
      },
      27 => {
        1..199      =>1,
        252..646    =>2,
      },
      28 => {
        0..42       =>1,
        43..1100    =>2,
      },
      # 29 is complicated...skipping some parts
      29 => {
        1..99       =>1,
        100..459    =>2,
        500..899    =>3,
        900..1691   =>4,
        1911..1925  =>7,
        1926..1926  =>8,
        1927..4907  =>9,
      },
      30 => {
        1..199      =>1,
        201..402    =>2,
        700..955    =>3,
      },
      31 => {
        0..199      =>1,
        202..904    =>2,
      },
      32 => {
        1..190      =>1,
        191..399    =>2,
        400..627    =>3,
        630..668    =>4,
        700..799    =>5,
        800..2800   =>6,
      },
      33 => {
        1..120      =>1,
        125..187    =>2,
        203..499    =>3,
      },
      34 => {
        3..299      =>1,
        300..399    =>2,
        400..1200   =>3,
      },
      36 => {
        1..199      =>1,
        200..299    =>2,
        312..1600   =>3,
      },
      38 => {
        0..17       =>1,
        18..61      =>2,
      },
      # 40 is complicated...skipping some parts
      40 => {
        1..49       =>1,
        50..51      =>2,
        53..59      =>5,
        60..60      =>6,
        61..62      =>8,
        64..71      =>13,
        72..80      =>14,
        81..85      =>15,
        87..99      =>18,
        100..135    =>19,
        136..149    =>20,
        150..189    =>21,
        190..259    =>22,
        260..265    =>23,
        266..282    =>24,
        300..399    =>25,
        400..424    =>26,
        425..699    =>27,
        700..789    =>28,
        790..1700   =>29,
      },
      41 => {
        50..61      =>1,
        101..101    =>2,
        102..128    =>3,
        300..304    =>4,
      },
      42 => {
        1..399      =>1,
        400..424    =>2,
        430..1008   =>3,
      },
      43 => {
        1..999      =>1,
        1000..10010 =>2,
      },
      45 => {
        1..199      =>1,
        200..499    =>2,
        500..1199   =>3,
        1201..2555  =>4,
      },
      46 => {
        1..39       =>1,
        41..69      =>2,
        70..89      =>3,
        90..139     =>4,
        140..155    =>5,
        159..165    =>6,
        166..199    =>7,
        200..404    =>8,
        501..565    =>9,
      },
      47 => {
        0..19       =>1,
        20..39      =>2,
        42..69      =>3,
        70..79      =>4,
        80..301     =>5,
      },
      48 => {
        1..51       =>1,
        52..99      =>2,
        201..253    =>3,
        301..653    =>4,
        701..1499   =>5,
        1501..2852  =>6,
        2901..9905  =>7,
      },
      49 => {
        1..99       =>1,
        105..185    =>2,
        190..199    =>3,
        200..399    =>4,
        450..599    =>5,
        601..999    =>6,
        1000..1199  =>7,
        1200..1572  =>8,
      },
      # 50 is complicated...skipping some parts
      50 => {
        1..16       =>1,
        18..199     =>5,
        216..560    =>6,
        600..697    =>7,
      },
   },
   2002 => {
      5 => {
        1..630      =>1,
        715..1001   =>2,
        1200..8701  =>3,
      },
      # 7 is complicated...skipping some parts
      7 => {
        1..26       =>1,
        27..52      =>2,
        53..209     =>3,
        210..295    =>4,
        400..699    =>6,
        700..868    =>7,
        1200..1570  =>10,
        1600..1899  =>11,
        1900..1930  =>12,
        1940..1949  =>13,
        1950..1980  =>14,
        2003..4287  =>15,
      },
      9 => {
        1..199      =>1,
        200..500    =>2,
      },
      10 => {
        1..50       =>1,
        51..199     =>2,
        202..499    =>3,
        500..1800   =>4,
      },
      12 => {
        1..199      =>1,
        201..219    =>2,
        220..299    =>3,
        300..499    =>4,
        500..599    =>5,
        600..1815   =>6,
      },
      14 => {
        1..59       =>1,
        60..139     =>2,
        140..198    =>3,
        200..1199   =>4,
        1200..1300  =>5,
      },
      15 => {
        0..299      =>1,
        301..799    =>2,
        801..2301   =>3,
      },
      17 => {
        1..199      =>1,
        200..239    =>2,
        240..450    =>3,
      },
      19 => {
        1..140      =>1,
        141..192    =>2,
        200..357    =>3,
      },
      20 => {
        1..375      =>1,
        400..499    =>2,
        501..1001   =>3,
      },
      21 => {
        1..99       =>1,
        100..169    =>2,
        170..199    =>3,
        300..499    =>5,
        500..599    =>6,
        600..799    =>7,
        800..1299   =>8,
      },
      22 => {
        1..229      =>1,
        301..1701   =>2,
      },
      24 => {
        0..180      =>1,
        200..499    =>2,
        500..699    =>3,
        700..1699   =>4,
        1710..4100  =>5,
      },
      # 26  is complicated...skipping some parts
      26 => {
        2..29       =>13,
        31..39      =>14,
        40..49      =>15,
        50..156     =>16,
        300..420    =>17,
        500..521    =>18,
        600..801    =>19,
      },
      27 => {
        1..199      =>1,
        251..285    =>2,
      },
      28 => {
        0..42       =>1,
        43..1100    =>2,
      },
      # 29 is complicated...skipping some parts
      29 => {
        1..99       =>1,
        100..459    =>2,
        500..899    =>3,
        900..1899   =>4,
        1926..1926  =>8,
        1927..4907  =>9,
      },
      30 => {
        1..199      =>1,
        201..402    =>2,
        700..955    =>3,
      },
      31 => {
        0..129      =>1,
        202..904    =>2,
      },
      32 => {
        1..190      =>1,
        191..399    =>2,
        630..668    =>4,
        700..776    =>5,
        800..2800   =>6,
      },
      33 => {
        1..120      =>1,
        125..187    =>2,
        203..499    =>3,
      },
      34 => {
        3..299      =>1,
        300..399    =>2,
        400..1200   =>3,
      },
      36 => {
        1..199      =>1,
        200..298    =>2,
        312..1600   =>3,
      },
      38 => {
        0..17       =>1,
        18..59      =>2,
      },
      # 40 is complicated...skipping some parts
      40 => {
        50..51      =>2,
        53..59      =>5,
        60..60      =>6,
        61..62      =>8,
        64..71      =>12,
        72..80      =>13,
        81..85      =>14,
        87..99      =>17,
        100..135    =>18,
        136..149    =>19,
        150..189    =>20,
        190..258    =>21,
        260..265    =>22,
        266..282    =>23,
        300..399    =>24,
        400..424    =>25,
        425..699    =>26,
        700..789    =>27,
        790..1700   =>28,
      },
      #41  is complicated...skipping some parts
      41 => {
        50..61      =>1,
        102..128    =>2,
      },
      42 => {
        1..137      =>1,
        400..424    =>2,
        430..1008   =>3,
      },
      43 => {
        1..999      =>1,
        1000..10010 =>2,
      },
      45 => {
        1..199      =>1,
        200..499    =>2,
        500..1185   =>3,
        1201..2555  =>4,
      },
      46 => {
        1..39       =>1,
        41..69      =>2,
        70..89      =>3,
        90..139     =>4,
        140..155    =>5,
        159..165    =>6,
        166..199    =>7,
        200..404    =>8,
        501..565    =>9,
      },
      47 => {
        0..19       =>1,
        20..39      =>2,
        42..69      =>3,
        70..79      =>4,
        80..301     =>5,
      },
      48 => {
        1..51       =>1,
        52..99      =>2,
        201..253    =>3,
        301..653    =>4,
        701..1499   =>5,
        1501..2852  =>6,
        2901..9905  =>7,
      },
      49 => {
        1..99       =>1,
        105..180    =>2,
        190..199    =>3,
        200..399    =>4,
        450..999    =>5,
        1000..1199  =>6,
        1200..1550  =>7,
      },
      # 50 is complicated...skipping some parts
      50 => {
        18..199     =>5,
        216..560    =>6,
        600..697    =>7,
      },
   },
   2001 => {
      5 => {
        1..630      =>1,
        715..1001   =>2,
        1200..8701  =>3,
      },
      # 7 is complicated...skipping some parts
      7 => {
        1..26       =>1,
        27..52      =>2,
        53..209     =>3,
        210..295    =>4,
        300..399    =>5,
        400..699    =>6,
        700..868    =>7,
        1200..1570  =>10,
        1600..1899  =>11,
        1900..1939  =>12,
        1940..1948  =>13,
        1950..1980  =>14,
        2003..4287  =>15,
      },
      9 => {
        1..199      =>1,
        200..500    =>2,
      },
      10 => {
        1..50       =>1,
        51..199     =>2,
        202..499    =>3,
        500..1800   =>4,
      },
      12 => {
        1..199      =>1,
        201..219    =>2,
        220..299    =>3,
        300..499    =>4,
        500..599    =>5,
        600..619    =>6,
      },
      14 => {
        1..59       =>1,
        60..139     =>2,
        140..198    =>3,
        200..450    =>4,
        1200..1299  =>5,
      },
      15 => {
        0..295      =>1,
        301..799    =>2,
        801..2301   =>3,
      },
      16 => {
        0..999      =>1,
        1000..1750  =>2,
      },
      17 => {
        1..199      =>1,
        200..239    =>2,
        240..450    =>3,
      },
      18 => {
        1..399      =>1,
        401..1317   =>2,
      },
      19 => {
        1..140      =>1,
        141..199    =>2,
        201..357    =>3,
      },
      20 => {
        1..375      =>1,
        400..499    =>2,
        501..1001   =>3,
      },
      21 => {
        1..99       =>1,
        100..169    =>2,
        170..199    =>3,
        200..299    =>4,
        300..499    =>5,
        500..599    =>6,
        600..799    =>7,
        800..1299   =>8,
        1301..1499  =>9,
      },
      22 => {
        1..299      =>1,
        301..1701   =>2,
      },
      24 => {
        0..180      =>1,
        200..499    =>2,
        500..699    =>3,
        700..1699   =>4,
        1710..4100  =>5,
      },
      # 26  is complicated...skipping some parts
      26 => {
        2..29       =>13,
        31..39      =>14,
        40..49      =>15,
        50..156     =>16,
        300..499    =>17,
        500..521    =>18,
        600..801    =>19,
      },
      27 => {
        1..199      =>1,
        200..296    =>2,
      },
      28 => {
        0..42       =>1,
        43..901     =>2,
      },
      # 29 is complicated...skipping some parts
      29 => {
        1..99       =>1,
        100..459    =>2,
        500..899    =>3,
        900..1691   =>4,
        1911..1925  =>7,
        1926..1926  =>8,
        1927..4907  =>9,
      },
      30 => {
        1..199      =>1,
        201..699    =>2,
        700..955    =>3,
      },
      31 => {
        0..199      =>1,
        202..904    =>2,
      },
      32 => {
        1..190      =>1,
        191..399    =>2,
        400..627    =>3,
        630..699    =>4,
        700..799    =>5,
        800..2103   =>6,
      },
      33 => {
        1..120      =>1,
        125..199    =>2,
        203..499    =>3,
      },
      34 => {
        3..299      =>1,
        300..396    =>2,
        400..1200   =>3,
      },
      36 => {
        2..199      =>1,
        200..299    =>2,
        312..1600   =>3,
      },
      38 => {
        0..17       =>1,
        18..59      =>2,
      },
      # 40 is complicated...skipping some parts
      40 => {
        1..49       =>1,
        50..51      =>2,
        53..59      =>5,
        61..62      =>8,
        64..71      =>12,
        72..80      =>13,
        81..85      =>14,
        87..99      =>17,
        100..135    =>18,
        136..149    =>19,
        150..180    =>20,
        190..258    =>21,
        260..265    =>22,
        266..282    =>23,
        300..399    =>24,
        400..424    =>25,
        425..699    =>26,
        700..766    =>27,
        790..1700   =>28,
      },
      41 => {
        50..61      =>1,
        101..101    =>2,
        102..128    =>3,
        300..304    =>4,
      },
      42 => {
        1..399      =>1,
        400..424    =>2,
        430..1008   =>3,
      },
      43 => {
        1..999      =>1,
        1000..10010 =>2,
      },
      45 => {
        1..199      =>1,
        200..499    =>2,
        500..1199   =>3,
        1201..2555  =>4,
      },
      46 => {
        1..39       =>1,
        41..69      =>2,
        70..89      =>3,
        90..139     =>4,
        140..155    =>5,
        159..165    =>6,
        166..199    =>7,
        200..404    =>8,
        501..565    =>9,
      },
      47 => {
        0..19       =>1,
        20..39      =>2,
        42..69      =>3,
        70..79      =>4,
        80..300     =>5,
      },
      48 => {
        1..51       =>1,
        52..99      =>2,
        201..253    =>3,
        301..653    =>4,
        701..1499   =>5,
        1501..2852  =>6,
        2901..9905  =>7,
      },
      49 => {
        1..99       =>1,
        106..180    =>2,
        190..199    =>3,
        200..399    =>4,
        450..999    =>5,
        1000..1199  =>6,
        1200..1420  =>7,
      },
      50 => {
        1..199      =>1,
        216..560    =>2,
        600..697    =>3,
      },
   },
   2000 => {
      5 => {
        715..1001   =>2,
        1200..8701  =>3,
      },
      # 7 is complicated...skipping some parts
      7 => {
        1..26       =>1,
        27..52      =>2,
        53..209     =>3,
        210..295    =>4,
        300..399    =>5,
        400..699    =>6,
        700..868    =>7,
        1200..1570  =>10,
        1600..1899  =>11,
        1900..1939  =>12,
        1940..1948  =>13,
        1950..1980  =>14,
        2003..4287  =>15,
      },
      9 => {
        1..199      =>1,
        200..500    =>2,
      },
      10 => {
        1..50       =>1,
        51..171     =>2,
        202..499    =>3,
        500..1706   =>4,
      },
      12 => {
        1..34       =>1,
        201..219    =>2,
        220..299    =>3,
        300..412    =>4,
        600..1815   =>6,
      },
      14 => {
        1..49       =>1,
        60..139     =>2,
        140..198    =>3,
        200..1199   =>4,
        1200..1274  =>5,
      },
      15 => {
        0..299      =>1,
        301..799    =>2,
        801..2301   =>3,
      },
      16 => {
        0..999      =>1,
        1000..1750  =>2,
      },
      17 => {
        1..199      =>1,
        200..239    =>2,
        240..450    =>3,
      },
      18 => {
        1..399      =>1,
        401..1316   =>2,
      },
      19 => {
        1..134      =>1,
        141..199    =>2,
        201..357    =>3,
      },
      20 => {
        400..499    =>2,
        501..1001   =>3,
      },
      21 => {
        1..99       =>1,
        100..169    =>2,
        170..199    =>3,
        200..299    =>4,
        300..499    =>5,
        500..599    =>6,
        600..799    =>7,
        800..1299   =>8,
        1301..1499  =>9,
      },
      24 => {
        0..180      =>1,
        200..499    =>2,
        500..699    =>3,
        700..1699   =>4,
        1710..4100  =>5,
      },
      # 26  is complicated...skipping some parts
      26 => {
        2..29       =>13,
        31..39      =>14,
        50..156     =>16,
        300..499    =>17,
        500..521    =>18,
        600..801    =>19,
      },
      27 => {
        1..199      =>1,
        200..296    =>2,
      },
      28 => {
        0..42       =>1,
        43..701     =>2,
      },
      # 29 is complicated...skipping some parts
      29 => {
        1..99       =>1,
        100..459    =>2,
        500..899    =>3,
        900..1691   =>4,
        1911..1925  =>7,
        1926..1926  =>8,
        1927..4907  =>9,
      },
      30 => {
        1..199      =>1,
        201..699    =>2,
        700..955    =>3,
      },
      31 => {
        0..199      =>1,
        202..605    =>2,
      },
      32 => {
        1..190      =>1,
        191..399    =>2,
        400..627    =>3,
        630..699    =>4,
        700..799    =>5,
        800..2103   =>6,
      },
      33 => {
        1..120      =>1,
        125..199    =>2,
        203..499    =>3,
      },
      34 => {
        3..299      =>1,
        300..399    =>2,
        400..1200   =>3,
      },
      36 => {
        2..199      =>1,
        200..299    =>2,
        312..1521   =>3,
      },
      38 => {
        0..17       =>1,
        18..58      =>2,
      },
      # 40 is complicated...skipping some parts
      40 => {
        1..49       =>1,
        50..51      =>2,
        53..59      =>5,
        60..60      =>6,
        61..62      =>7,
        64..71      =>10,
        72..80      =>11,
        81..85      =>12,
        86..86      =>13,
        87..135     =>14,
        136..149    =>15,
        150..189    =>16,
        190..258    =>17,
        260..265    =>18,
        266..299    =>19,
        400..424    =>21,
        425..699    =>22,
        700..789    =>23,
      },
      41 => {
        50..60      =>1,
        101..101    =>2,
        102..128    =>3,
        300..304    =>4,
      },
      42 => {
        1..399      =>1,
        400..424    =>2,
        430..1008   =>3,
      },
      43 => {
        1..999      =>1,
        1000..10010 =>2,
      },
      45 => {
        1..199      =>1,
        200..499    =>2,
        500..1199   =>3,
        1201..2555  =>4,
      },
      46 => {
        1..39       =>1,
        42..69      =>2,
        70..89      =>3,
        90..139     =>4,
        140..155    =>5,
        159..165    =>6,
        166..199    =>7,
        200..404    =>8,
        501..565    =>9,
      },
      47 => {
        0..19       =>1,
        20..39      =>2,
        42..69      =>3,
        70..79      =>4,
        80..300     =>5,
      },
      48 => {
        1..51       =>1,
        52..99      =>2,
        201..253    =>3,
        701..1499   =>5,
        1501..2852  =>6,
        2901..9905  =>7,
      },
      49 => {
        1..99       =>1,
        106..180    =>2,
        190..199    =>3,
        200..399    =>4,
        450..999    =>5,
        1000..1199  =>6,
        1200..1420  =>7,
      },
      50 => {
        1..199      =>1,
        216..560    =>2,
        600..697    =>3,
      },
   },
  }
  
  def add_cfr_links(text, date = Time.local.to_date)
    text.gsub(/(\d+)\s+(?:CFR|C\.F\.R\.)\s+(?:[Pp]arts?|[Ss]ections?|[Ss]ec\.|&#xA7;|&#xA7;\s*&#xA7;)?\s*(\d+)(?:\.(\d+))?/) do |str|
      title = $1
      part = $2
      section = $3
      
      current_url  = cfr_url(Time.local.to_date, title, part, section)
      historic_url = cfr_url(date, title, part, section)
      
      if current_url || historic_url
        options = {
          :href => (current_url || historic_url),
          :class => "cfr external",
          :target => "_blank",
        }
        
        if current_url.present? && current_url != historic_url
          options['data-historic-citation-url'] = historic_url
        end
        
        content_tag :a, str, options
      else
        str
      end
    end
  end
  
  def cfr_url(date, title, part, section='')
    year = cfr_edition(title, date)
    return if year.blank?
    
    vol = cfr_volume(year,title,part)
    return if vol.blank?
      "http://www.gpo.gov/fdsys/pkg/CFR-#{year}-title#{title}-vol#{vol}/xml/CFR-#{year}-title#{title}-vol#{vol}-#{section.present? ? "sec#{part}-#{section}" : "part#{part}"}.xml"
  end
  
  def cfr_volume(year, title, part)
    year = TITLE_AND_PART_TO_VOLUME[year]
    return if year.blank?
    part_to_volume_mapping = year[title.to_i]
    
    if part_to_volume_mapping.present?
      part_to_volume_mapping.each_pair do |part_range, volume|
        return volume if part_range.include?(part.to_i)
      end
      return nil
    else
      1
    end
  end
  
  def cfr_edition(title, date)
    EDITION_SCHEDULE.each_pair do |title_range, month_and_day|
      if title_range.include?(title.to_i)
        issue_date = Date.parse("#{date.year}-#{month_and_day}")
        if issue_date + CFR_EDITION_PUBLICATION_OFFSET > date
          return date.year - 1
        else
          return date.year
        end
      end
    end
    
    nil
  end
end